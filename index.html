<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Checklist Empilhadeira - log20 checklist</title>
<style>
  body { font-family: Arial, sans-serif; background: #0d1f0d; color: #fff; margin: 0; padding: 20px; }
  h2 { text-align: center; }
  .container { max-width: 700px; margin: auto; background: #1f3b1f; padding: 20px; border-radius: 10px; }
  input, button, textarea { width: 100%; padding: 10px; margin-top: 8px; border-radius: 6px; border: none; box-sizing: border-box; }
  button { background: #198754; color: white; font-weight: bold; cursor: pointer; }
  button[disabled] { opacity: 0.6; cursor: not-allowed; }
  button:hover:not([disabled]) { background: #157347; }
  .item { margin-bottom: 12px; padding: 12px; background: #2e4c2e; border-radius: 6px; }
  label { display: block; margin-bottom: 6px; font-weight: bold; }
  .btn-group { display: flex; justify-content: space-between; gap: 4px; }
  .btn-group button { width: 48%; transition: all 0.12s ease-in-out; padding: 10px; border-radius: 6px; border: none; font-weight: bold; cursor: pointer; }
  .btn-yes { background: #28a745; color: #fff; }
  .btn-no { background: #dc3545; color: #fff; }
  .btn-yes.active { background: #3cd65a; box-shadow: 0 0 12px rgba(40,167,69,0.8); transform: scale(1.03); }
  .btn-no.active { background: #ff4d4d; box-shadow: 0 0 12px rgba(220,53,69,0.85); transform: scale(1.03); }
  .hidden { display: none; }
  .date-time { text-align: center; font-size: 14px; margin-top: 10px; color: #ccc; }
  .desc-wrap { margin-top: 10px; }
  .desc-wrap textarea { min-height: 70px; resize: vertical; }
  .small { font-size: 13px; color: #d1d1d1; margin-top: 6px; }
  .success-emoji { font-size: 48px; margin-bottom: 8px; display:block; text-align:center; }
</style>
</head>
<body>
<div id="pagina-inicial" class="container">
  <h2>Checklist Diário - Empilhadeira Log20</h2>
  <label>Nome do Operador:</label>
  <input id="operador" type="text" placeholder="Digite o nome do operador" />

  <label>Número da Máquina:</label>
  <input id="maquina" type="text" placeholder="Digite o número da máquina" />

  <label>Horímetro:</label>
  <input id="horimetro" type="number" step="0.1" placeholder="ex: 3456.7" min="0" />

  <button id="btn-iniciar" onclick="mostrarAviso()">Iniciar Checklist</button>
  <div class="small">Preencha os campos acima e clique em "Iniciar Checklist".</div>
</div>

<div id="pagina-checklist" class="container hidden">
  <h2>Checklist Diário</h2>
  <div class="date-time" id="dataHora"></div>
  <div id="infoOperador" class="small"></div>
  <div id="checklist"></div>
  <button id="btn-pdf" onclick="gerarPDF()" disabled>Gerar Relatório (PDF)</button>
  <div class="small">Itens marcados como <strong>Não</strong> precisam de descrição. Tempo mínimo de 3 minutos para liberar PDF.</div>
  <div id="timerTexto" class="small" style="text-align:center;margin-top:8px;"></div>
  <button onclick="voltarInicio()" style="background:#6c757d;">Voltar</button>
</div>

<div id="pagina-sucesso" class="container hidden">
  <div class="success-emoji">✅</div>
  <h2 style="text-align:center">Checklist executado com sucesso!</h2>
  <div class="small" style="text-align:center">O PDF foi gerado e salvo no seu dispositivo.</div>
  <button onclick="voltarAoInicioPosSucesso()">Voltar ao início</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
<script>
const { jsPDF } = window.jspdf;
const perguntas = [
  "Pontos de apoio estão OK?",
  "Painel de instrumentos está OK?",
  "Sensor de banco está OK?",
  "Cinto de segurança está ok",
  "Buzina está OK?",
  "Sensor de cinto está OK?",
  "Limpador de para-brisas está OK?",
  "Para-brisa e teto estão OK?",
  "Retrovisores estão OK?",
  "Freios estão OK?",
  "Extintor está OK?",
  "LEDs laterais estão OK?",
  "Blue Spot está OK?",
  "Lâmpadas dianteiras estão OK?",
  "Lâmpadas traseiras estão OK?",
  "Sirene de ré está OK?",
  "Ausência de vazamento de óleo?",
  "Mangueiras da torre estão OK?",
  "Garfo está OK?",
  "Pneus estão OK?",
  "Rodas estão OK?"
];

const respostas = {};
const descricoes = {};
let dataHoraAtual = "";
let timer = null;
let tempoRestante = 180;

function mostrarAviso(){
  const operador=document.getElementById('operador').value.trim();
  const maquina=document.getElementById('maquina').value.trim();
  const horimetro=document.getElementById('horimetro').value.trim();
  if(!operador||!maquina||!horimetro){alert('Preencha todos os campos.');return;}
  alert('⚠️ O checklist é OBRIGATÓRIO e possui tempo mínimo de 3 minutos antes de gerar o PDF.');
  iniciarChecklist();
}

function iniciarChecklist(){
  document.getElementById('pagina-inicial').classList.add('hidden');
  document.getElementById('pagina-checklist').classList.remove('hidden');
  dataHoraAtual = new Date().toLocaleString('pt-BR');
  document.getElementById('dataHora').innerText = `Data e hora: ${dataHoraAtual}`;
  const operador=document.getElementById('operador').value.trim();
  const maquina=document.getElementById('maquina').value.trim();
  const horimetro=document.getElementById('horimetro').value.trim();
  document.getElementById('infoOperador').innerText=`Operador: ${operador} — Máquina: ${maquina} — Horímetro: ${horimetro}`;
  const checklist=document.getElementById('checklist');
  checklist.innerHTML='';
  perguntas.forEach((p,i)=>{
    respostas[p]='Não respondido';descricoes[p]='';
    const div=document.createElement('div');
    div.className='item';
    div.innerHTML=`<label>${p}</label><div class='btn-group'><button class='btn-yes' onclick="responder(${i},'Sim')">Sim</button><button class='btn-no' onclick="responder(${i},'Não')">Não</button></div><div class='desc-wrap hidden' id='desc-${i}w'><label>Descreva o problema:</label><textarea id='desc-${i}'></textarea></div>`;
    checklist.appendChild(div);
  });
  iniciarTemporizador();
}

function responder(i,valor){
  const p=perguntas[i];respostas[p]=valor;
  const yes=document.querySelectorAll('.btn-yes')[i];
  const no=document.querySelectorAll('.btn-no')[i];
  yes.classList.remove('active');no.classList.remove('active');
  const wrap=document.getElementById(`desc-${i}w`);
  if(valor==='Sim'){yes.classList.add('active');wrap.classList.add('hidden');}
  else{no.classList.add('active');wrap.classList.remove('hidden');}
}

function iniciarTemporizador(){
  const btn=document.getElementById('btn-pdf');
  const timerTexto=document.getElementById('timerTexto');
  tempoRestante=180;
  timerTexto.innerText=`Tempo restante: 3:00`;
  btn.disabled=true;
  timer=setInterval(()=>{
    tempoRestante--;
    const min=Math.floor(tempoRestante/60);
    const seg=(tempoRestante%60).toString().padStart(2,'0');
    timerTexto.innerText=`Tempo restante: ${min}:${seg}`;
    if(tempoRestante<=0){
      clearInterval(timer);
      btn.disabled=false;
      timerTexto.innerText='Tempo mínimo concluído! Já é possível gerar o PDF.';
    }
  },1000);
}

function gerarPDF(){
  if(tempoRestante>0){alert('Aguarde o tempo mínimo de 3 minutos para gerar o relatório.');return;}
  for(let i=0;i<perguntas.length;i++){
    const p=perguntas[i];
    if(respostas[p]==='Não'){
      const desc=document.getElementById(`desc-${i}`).value.trim();
      if(!desc)return alert(`Descreva o problema em: ${p}`);
      descricoes[p]=desc;
    }
  }
  const operador=document.getElementById('operador').value.trim();
  const maquina=document.getElementById('maquina').value.trim();
  const horimetro=document.getElementById('horimetro').value.trim();
  const doc=new jsPDF({unit:'pt',format:'a4'});
  doc.setFontSize(16);
  doc.text('Relatório Diário - Empilhadeira',doc.internal.pageSize.getWidth()/2,40,{align:'center'});
  doc.setFontSize(10);
  doc.text(`Operador: ${operador} | Máquina: ${maquina} | Horímetro: ${horimetro} | ${dataHoraAtual}`,40,60);
  doc.autoTable({startY:80,head:[['Item','Situação','Descrição']],body:perguntas.map((p,i)=>[p,respostas[p],descricoes[p]||'']),styles:{fontSize:9,cellPadding:3},headStyles:{fillColor:[200,200,200]},});
  try{doc.save(`Checklist_${operador||'Operador'}.pdf`);}catch(e){alert('Erro ao salvar PDF.');}
  document.getElementById('pagina-checklist').classList.add('hidden');
  document.getElementById('pagina-sucesso').classList.remove('hidden');
}

function voltarInicio(){location.reload();}
function voltarAoInicioPosSucesso(){location.reload();}
</script>
</body>
</html>